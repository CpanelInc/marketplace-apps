-
# motd and creds gen
- name: copy MOTD template to /etc/motd
  template:
    src: templates/motd.j2
    dest: /etc/motd

- name: retrieve Jupyter logs
  command: docker logs jupyter_jupyterlab_1
  register: jupyter_logs

- name: Print Jupyter logs
  debug:
    var: jupyter_logs.stdout_lines

- name: Wait for 60 seconds
  pause:
    seconds: 60

- name: extract Jupyter token from logs
  set_fact:
    jupyter_token: "{{ item.split('token=')[1].split()[0] }}"
  loop: "{{ jupyter_logs.stdout.split('\n') }}"
  when: "'token=' in item"

- name: writing creds into file
  copy:
    dest: /root/.credentials
    mode: '0600'
    content: |
      Sudo Username: {{ username }}
      Sudo Password: {{ password }}
      Jupyter Token: {{ jupyter_token | default('Token not found') }}