- name: std out docker logs
  ansible.builtin.shell: docker logs jupyter_jupyterlab_1
  register: result
 # until handles docker catching up with ansible. something like this is preferable to ignore_errors true
  until: "result is not failed"
  retries: 3
  delay: 3

- name: set jupyter token fact 
  ansible.builtin.set_fact: 
    jupyter_token: "{{ result.stdout | regex_search('(?<=token=)[^ ]+') }}"
    cacheable: yes

- name: writing creds into file
  copy:
    dest: /root/.credentials
    mode: '0600'
    content: |
      Sudo Username: {{ username }}
      Sudo Password: {{ password }}
      Jupyter Token: {{ jupyter_token }}

# motd and creds gen
- name: copy MOTD template to /etc/motd
  template:
    src: templates/motd.j2
    dest: /etc/motd